@page "/historial"
@using Horoscopo.Core.Entities
@inject HttpClient _http
@inject NavigationManager _navigationManager

<div class="pantalla-contenedor">
    <div class="header-azul">
        <button class="btn-volver-circular" @onclick='() => _navigationManager.NavigateTo("/resultado")'>
            <i class="bi bi-arrow-left"></i> <span>←</span>
        </button>
        <span class="header-titulo">Historial de Consultas</span>
    </div>

    <div class="contenido-historial">
        @if (_listaHistorial == null)
        { 
            <div class="contenedor-prediccion">
                <p class="texto-prediccion mt-3">
                    Cargando historial...
                </p>
            </div>
        }
        else if (!_listaHistorial.Any())
        {
            <p class="text-center mt-5">No hay consultas registradas aún.</p>
        }
        else
        {
            <div class="listado-cards">
                @foreach (var item in _listaHistorial)
                {
                    <div class="card-consulta">
                        <div class="icono-signo-contenedor">
                            <img src="images/boton_@(item.Signo.ToLower()).png" alt="@item.Signo" />
                        </div>
                        <div class="info-consulta">
                            <span class="nombre-usuario">@item.Nombre</span>
                            <span class="nombre-usuario">@(string.IsNullOrEmpty(item.Email) ? "No ingreso correo" : item.Email) </span>
                            <span class="detalle-signo">@item.Signo - @item.Genero</span>
                            <span class="fecha-consulta">@item.FechaConsulta.ToString("dd/MM/yyyy HH:mm")</span>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>
 

@code {
    private List<Historial>? _listaHistorial;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _listaHistorial = await _http.GetFromJsonAsync<List<Historial>>("api/horoscopo/historial");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al cargar historial: {ex.Message}");
        }
    }
}